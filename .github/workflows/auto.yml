name: IPTV æ”¶é›†åˆä½µã€å»é‡èˆ‡æœ‰æ•ˆæ€§æª¢æŸ¥

on:
  schedule:
    - cron: '10 23 * * *'  # æ¯å¤© 23:10 è‡ªå‹•åŸ·è¡Œ
  workflow_dispatch:       # æ”¯æ´æ‰‹å‹•åŸ·è¡Œ
    branches:
      - main

jobs:
  iptv_build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v4

    - name: ğŸ è¨­å®š Python ç’°å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: 3.x

    - name: ğŸ“¦ å®‰è£ Python ä¾è³´
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt || true
        pip install selenium requests futures eventlet opencv-python beautifulsoup4 translate termcolor func_timeout replace input opencc pypinyin pytz tqdm webdriver-manager

    - name: âš™ï¸ è¨­å®š Git ä½¿ç”¨è€…è³‡è¨Š
      run: |
        git config --global user.name "WaykeYu"
        git config --global user.email "waykeyu@example.com"

    - name: ğŸ§ª åŸ·è¡Œ IPTV è…³æœ¬
      run: |
        python py/net-collect.py
        python py/collect.py
        python py/integ.py
        # å¦‚éœ€å•Ÿç”¨ç¢ºèªæœ‰æ•ˆæ€§ï¼Œå–æ¶ˆä¸‹ä¸€è¡Œè¨»è§£ï¼š
        # python py/confirm.py

    - name: ğŸ“ æ›´æ–° README.md æ™‚é–“æˆ³
      run: |
        echo -e "## è‡ªå‹•éæ¿¾é‡è¤‡èˆ‡ç¢ºèªæœ‰æ•ˆæ€§ IPTV\n\næ›´æ–°æ™‚é–“ï¼š$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')\n" > README.md

    - name: âœ… æäº¤ä¸¦æ¨é€æ›´æ”¹
      run: |
        git config --local user.email "actions@126.com"
        git config --local user.name "GitHub Action"
        git add .
        git commit -m "ğŸ“… è‡ªå‹•æ›´æ–° IPTV è³‡æ–™" || echo "No changes to commit"
        git pull --rebase
        git push
